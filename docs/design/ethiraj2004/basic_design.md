# åŸºæœ¬è¨­è¨ˆï¼ˆEthiraj & Levinthal 2004 ã‚·ãƒŠãƒªã‚ªï¼‰

## 1. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆã¨ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
| ãƒ¬ã‚¤ãƒ¤ | ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | å½¹å‰² |
| --- | --- | --- |
| çœŸã®æ§‹é€  | `cmis_nk.ethiraj2004.landscape` | çœŸã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ ï¼ˆMå€‹ï¼‰ã¨ã€ãã‚Œã«åŸºã¥ãä¾å­˜æ§‹é€ ãƒ»å±€æ‰€è²¢çŒ®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”Ÿæˆã€‚|
| ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼è¦–ç‚¹ | `cmis_nk.ethiraj2004.landscape` | K å€‹ã®ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆå‡ç­‰å‰²ã‚Šï¼‰ã‚’ç”Ÿæˆã—ã€å¾Œç¶šã®å±€æ‰€æ¢ç´¢ãƒ»ãƒªã‚³ãƒ³ãƒ“ãƒãƒ¼ã‚·ãƒ§ãƒ³ã«ç”¨ã„ã‚‹ã€‚|
| ãƒ€ã‚¤ãƒŠãƒŸã‚¯ã‚¹ | `cmis_nk.ethiraj2004.dynamics` | L ç¤¾ Ã— K ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å±€æ‰€æ¢ç´¢ï¼‹ãƒªã‚³ãƒ³ãƒ“ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’é§†å‹•ã—ã€æœ€çµ‚çš„ãªæˆç†Ÿè¨­è¨ˆ d* å€™è£œã‚’å¾—ã‚‹ã€‚|
| ã‚²ãƒ¼ãƒ åŒ– | `cmis_nk.ethiraj2004.game_table` | ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ dâ° ã¨æˆç†Ÿè¨­è¨ˆ d*ï¼ˆã¾ãŸã¯ãã®è¤‡æ•° run ã®é›†åˆï¼‰ã‹ã‚‰ v(S) ã‚’ç®—å‡ºã—ã‚²ãƒ¼ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ§‹æˆã€‚|
| CLI/çµ±åˆ | `cmis_nk.pipeline` | `scenario.type=ethiraj2004` ã‚’èª­ã¿å–ã‚Šã€ä¸Šè¨˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ„ã¿åˆã‚ã›ã¦ CSV ã‚’å‡ºåŠ›ã€‚|

## 2. ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ æ¦‚è¦ï¼ˆä»•æ§˜ã‚¹ãƒ†ãƒƒãƒ—å¯¾å¿œï¼‰

ä¸‹è¡¨ã¯ã€è«–æ–‡ãƒ™ãƒ¼ã‚¹ã®ä»•æ§˜ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆ0ã€œ16ï¼‰ã‚’ã€æœ¬å®Ÿè£…ã®é–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹ã«å¯¾å¿œä»˜ã‘ãŸã‚‚ã®ã§ã™ã€‚

| ã‚¹ãƒ†ãƒƒãƒ— | å‡¦ç†å | å®Ÿè£…ä¸Šã®å¯¾å¿œ | å‚™è€ƒ |
| --- | --- | --- | --- |
| 0 | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š | `EthirajSettings`ï¼ˆ`config_loader.ExperimentConfig.ethiraj`ï¼‰ã¨ `ExperimentConfig` å…¨ä½“ã§ N, M, K, intra/inter, L, T, R ç­‰ã‚’ä¿æŒ | Rï¼ˆrunsï¼‰ã¯ç¾çŠ¶ `ExperimentConfig.runs` ã§ç®¡ç†ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 1ï¼‰ |
| 1 | çœŸã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ ç”Ÿæˆ | `build_true_modules(N, M)`ï¼ˆ`ethiraj2004.landscape`ï¼‰ã§ N ãƒ“ãƒƒãƒˆã‚’ M ã‚°ãƒ«ãƒ¼ãƒ—ã«ã»ã¼å‡ç­‰åˆ†å‰² | ä½™ã‚Šã¯å…ˆé ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ 1 ã¤ãšã¤åŠ ç®—ã•ã‚Œã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ |
| 2 | ç›¸äº’ä¾å­˜è¡Œåˆ— A_true ã®ç”Ÿæˆ | `build_ethiraj_landscape` å†…ã§ã€å„ãƒ“ãƒƒãƒˆ i ã«ã¤ã„ã¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ãƒ»é–“ã«ãƒã‚¤ã‚¢ã‚¹ã‚’ã‹ã‘ã¦ K å€‹ã®ä¾å­˜å…ˆã‚’ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã—ã€æš—é»™ã® A_true ã‚’æ§‹æˆ | è¡Œ i ã§ä¾å­˜å…ˆ j ã‚’é¸ã¶ã“ã¨ãŒ A_true[i,j]=1 ã«ç›¸å½“ |
| 3 | ä¾å­˜é›†åˆ N_i ã®æ§‹ç¯‰ | `NKLandscape.dependencies[i]` + è‡ªå·± i ã‚’çµ„ã¿åˆã‚ã›ã¦ N_i ã‚’å®šç¾© | N_i ã®ã‚µã‚¤ã‚ºã¯ä¸€å®šï¼ˆK+1ï¼‰ã ãŒã€ä»•æ§˜ã®ä¸€èˆ¬å½¢ã®ç‰¹æ®Šã‚±ãƒ¼ã‚¹ã¨ã—ã¦å®Ÿè£… |
| 4 | å±€æ‰€è²¢çŒ® f_i ã®ç”Ÿæˆ | `NKLandscape.from_random` ãŒå„ i, å„ãƒ“ãƒƒãƒˆåˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ä¸€æ§˜ä¹±æ•°å€¤ã‚’å‰²ã‚Šå½“ã¦ã€`tables[i]` ã¨ã—ã¦ä¿æŒ | ãƒ“ãƒƒãƒˆåˆ—â†’ã‚¹ã‚³ã‚¢ã®è¾æ›¸ã‚’ ndarray ã§å®Ÿè£… |
| 5 | æ€§èƒ½é–¢æ•° F ã®å®šç¾© | `NKLandscape.evaluate(state)` ãŒ F(d) = (1/N) Î£_i f_i(d\|_{N_i}) ã‚’è¨ˆç®— | ä»–ã‚·ãƒŠãƒªã‚ªã¨å…±é€šå®Ÿè£… |
| 6 | ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼æ§‹é€  ğ““ ã®ç”Ÿæˆ | `build_designer_modules(N, K)` ã§ N ãƒ“ãƒƒãƒˆã‚’ K ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã»ã¼å‡ç­‰åˆ†å‰²ã—ã€`designer_modules` ã¨ã—ã¦åˆ©ç”¨ | ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã¯çœŸã®æ§‹é€ ã‚’çŸ¥ã‚‰ãªã„å‰æ |
| 7 | ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³è¨­è¨ˆ dâ° ã®æ±ºå®š | `EthirajSettings.baseline_state`ï¼ˆYAML ã® `ethiraj.baseline_state`ã€‚æœªæŒ‡å®šãªã‚‰å…¨ 0ï¼‰ã‹ã‚‰ `bitstring_to_array` ã§ dâ° ã‚’ç”Ÿæˆã—ã€F(dâ°) ã‚’ `EthirajGameTableBuilder` å†…ã§è©•ä¾¡ | F(dâ°) ã¯ãƒ†ãƒ¼ãƒ–ãƒ«å†…ã® `baseline_fitness` ã‚«ãƒ©ãƒ ã«æ ¼ç´ |
| 8 | åˆæœŸä¼æ¥­é›†å›£ã®ç”Ÿæˆ | `EthirajFirmPopulation.__init__` ãŒ LÃ—N ã®ãƒ©ãƒ³ãƒ€ãƒ  0/1 è¡Œåˆ—ã¨ã—ã¦ {d^{(â„“)}\_0} ã‚’ç”Ÿæˆ | åˆæœŸçŠ¶æ…‹ã®æºã‚‰ã—æ–¹ã‚’å°†æ¥çš„ã«æ‹¡å¼µå¯èƒ½ |
| 9 | æ™‚é–“ã‚¹ãƒ†ãƒƒãƒ—ãƒ«ãƒ¼ãƒ— | `run_ethiraj_simulation` ãŒ t=0,â€¦,Tâˆ’1 ã«ã¤ã„ã¦å±€æ‰€æ¢ç´¢ï¼‹ãƒªã‚³ãƒ³ãƒ“ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ«ãƒ¼ãƒ— | `EthirajSettings.rounds` ãŒ T ã«å¯¾å¿œ |
| 10 | å±€æ‰€æ¢ç´¢ï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ¥ï¼‰ | `EthirajFirmPopulation.local_search_step` ãŒã€Œå„ä¼æ¥­ â„“ Ã— å„ D_kã€ã§ 1 ãƒ“ãƒƒãƒˆåè»¢æ¡ˆã‚’è©¦ã—ã€`_module_fitness` ã«åŸºã¥ã F_k(dâ€²) > F_k(d) ã®ã¨ãæ¡ç”¨ | F_k(d) ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ãƒ“ãƒƒãƒˆ i ã®å±€æ‰€è²¢çŒ®å¹³å‡ã§è¿‘ä¼¼ |
| 11 | ãƒªã‚³ãƒ³ãƒ“ãƒãƒ¼ã‚·ãƒ§ãƒ³ | `EthirajFirmPopulation.recombine` ãŒ mode ã«å¿œã˜ã¦ `_recombine_firm_level`ï¼`_recombine_module_level`ï¼ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚’å®Ÿè¡Œ | ç™ºç«é »åº¦ã¯ `recombination_interval` ã§åˆ¶å¾¡ |
| 12 | d* ã®å–å¾— | `run_ethiraj_simulation` ãŒæœ€çµ‚æ™‚åˆ»ã®å…¨ä¼æ¥­ã‚¹ã‚³ã‚¢ã‚’æ¯”è¼ƒã—ã€F(d^{(â„“)}\_T) æœ€å¤§ã®ä¼æ¥­ã®è¨­è¨ˆã‚’ best_stateï¼ˆæˆç†Ÿè¨­è¨ˆå€™è£œ d*ï¼‰ã¨ã—ã¦è¿”ã™ | ç¾çŠ¶ã¯ã€Œä»£è¡¨ä¼æ¥­ = æœ€è‰¯ä¼æ¥­ã€ã®æ–¹å¼ã‚’æ¡ç”¨ |
| 13 | d^C ã®æ§‹æˆ | `EthirajGameTableBuilder.build_table` ãŒã€å„ææº C ã«ã¤ã„ã¦ dâ° ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã—ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« C ã«å±ã™ã‚‹ãƒ“ãƒƒãƒˆã®ã¿ d* ã®å€¤ã«å…¥ã‚Œæ›¿ãˆã¦ d^C ã‚’æ§‹æˆ | ãƒ—ãƒ¬ã‚¤ãƒ¤é›†åˆ P ã¯ `players_basis` ã«å¿œã˜ã¦çœŸã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« or ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« |
| 14 | v(C) ã®è¨ˆç®— | åŒä¸Šã§ F(d^C) ã‚’è¨ˆç®—ã—ã€v(C) = F(d^C) âˆ’ F(dâ°) ã‚’ `v_value` ã¨ã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ ¼ç´ | ã‚²ãƒ¼ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ CSV ã§ `outputs/tables/ethiraj2004_baseline.csv` ã«ä¿å­˜ |
| 15 | è²¢çŒ®åº¦æŒ‡æ¨™ | ç¾å®Ÿè£…ã§ã¯ Shapley ç­‰ã®è²¢çŒ®åº¦è¨ˆç®—ã¯å®Ÿæ–½ã›ãšã€æœ¬ã‚²ãƒ¼ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å¤–éƒ¨ãƒ„ãƒ¼ãƒ«ã®å…¥åŠ›ã¨ã™ã‚‹ | ä»•æ§˜ã©ãŠã‚Šã€Œåˆ¥ãƒ•ã‚§ãƒ¼ã‚ºæ‰±ã„ã€ |
| 16 | çµæœä¿å­˜ãƒ»å¯è¦–åŒ– | æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ã‚²ãƒ¼ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ç°¡æ˜“ãƒ­ã‚°ï¼ˆå±¥æ­´ï¼‰ã¯ç”Ÿæˆã™ã‚‹ãŒã€å¯è¦–åŒ–ã¯ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ç­‰ã«å§”ã­ã‚‹ | å¿…è¦ã§ã‚ã‚Œã° `history` ã‚’ CSV ã«å‡ºåŠ›ã™ã‚‹æ‹¡å¼µãŒå¯èƒ½ |

## 3. ä¸»è¦ã‚¯ãƒ©ã‚¹æ¦‚è¦
- `EthirajLandscapeConfig`: N, M, intra_density, inter_density, seedã€‚
- `EthirajLandscapeFactory`: `build()` -> `NKLandscape` + `module_assignments`ã€‚
- `DesignerModules`:
  - å±æ€§: `designer_modules` (List[List[int]]), `true_modules`ã€‚
  - ãƒ¡ã‚½ãƒƒãƒ‰: `module_fitness(state, module_idx)`.
- `FirmPopulation`:
  - å±æ€§: `states` (np.ndarray shape (L, N)), `performance_history`.
  - ãƒ¡ã‚½ãƒƒãƒ‰: `local_search_step()`, `recombine(strategy)`.
- `EthirajGameTableBuilder`:
  - å¼•æ•°: `landscape`, `players_modules` (List[List[int]]), `baseline_state`, `mature_state`.
  - `build_table()` returns DataFrame with `v_value`, `absolute_fitness`, `notes`.

## 4. Config é …ç›®
```yaml
scenario:
  type: ethiraj2004
  players: true_modules | designer_modules
landscape:
  M: 3
  intra_density: 0.8
  inter_density: 0.2
firms:
  count: 12
  rounds: 200
  recombination: module_level
  recombination_interval: 5
```

## 5. CLI é€£æº
- `ExperimentConfig` ã« `ethiraj` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã€‚
- `run_experiment` ãŒ scenario.type ã‚’åˆ¤å®šã— `run_ethiraj_experiment()` ã‚’å‘¼ã¶ã€‚
- å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«: `outputs/tables/ethiraj2004_baseline.csv`ã€‚
